<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="web3.js"></script>
<script type="text/javascript">	
    var Web3 = require('web3');
    var web3 = new Web3();
	var abi=
	[{"name":"name"       ,"constant":true,"inputs":[],"outputs":[{"name":"","type":"string"}],"type":"function"},
	 {"name":"totalSupply","constant":true,"inputs":[],"outputs":[{"name":"","type":"uint256"}],"type":"function"},
	 {"name":"symbol"     ,"constant":true,"inputs":[],"outputs":[{"name":"","type":"string"}],"type":"function"},
	 {"name":"balanceOf"  ,"constant":true,"inputs":[{"name":"addr","type":"address"}],"outputs":[{"name":"","type":"uint256"}],"type":"function"},
	 {"inputs":[{"name":"initialSupply","type":"uint256"},{"name":"tokenName","type":"string"},{"name":"tokenSymbol","type":"string"}],"stateMutability":"nonpayable","type":"constructor"}	
	];
	
	var my =  web3.cph.contract(abi);

	var javaContract, ethContract;
	var transactionHash = null;
	var transactionHash1 = null;

	function trySetContract(){
		if( transactionHash != null ){
			receipt =  web3.cph.getTransactionReceipt(transactionHash);
			if( receipt != null ) {
			    alert( receipt.contractAddress);
				document.getElementById('ContractAddress1').innerText = receipt.contractAddress;
				javaContract = my.at(receipt.contractAddress);	
				transactionHash = null
				return
			}
		}			
	    setTimeout(trySetContract, 4000);
	}

	function trySetContract1(){
		if( transactionHash1 != null ){
			receipt =  web3.cph.getTransactionReceipt(transactionHash1);
			if( receipt != null ) {
			    alert( receipt.contractAddress);
				document.getElementById('ContractAddress2').innerText = receipt.contractAddress;
				ethContract = my.at(receipt.contractAddress);	
				transactionHash1 = null
				return
			}
		}			
	    setTimeout(trySetContract, 2000);		
	}
			  
	function deployContract(stype){
		var sFrom = document.getElementById('Acc1').value;
		if( sFrom.length < 40 ) return;
		var  sTo = document.getElementById('Acc2').value;
		var pwd = document.getElementById('Password').value		
		web3.setProvider(new web3.providers.HttpProvider(document.getElementById('rpcnode').value));
		web3.personal.unlockAccount(sFrom, pwd);
		
		if( stype=="java" ) {
			var code = document.getElementById('javabytes').value;
			temp = my.new("my",{from:sFrom, data:code,gas:6000000},function (e, contract){
					if( e != null ){
						alert(e);
						return;
					}
					if( typeof(contract.address) != 'undefined' || typeof(contract.transactionHash) != 'undefined'  ) {
						 transactionHash = contract.transactionHash;
					}
				} );
			 setTimeout(trySetContract, 2000);
			//javaContract = my.at("0xaD33183dCF3Dab0028Fd9d3d2854b25B58469aAf");
		}else{
			var code = document.getElementById('ethbytes').value;			
			temp = my.new("my", {from:sFrom, data:code,gas:1000000},function (e, contract){
					if( e != null ){
						alert(e);
						return;
					}
					if( typeof(contract.address) != 'undefined' || typeof(contract.transactionHash) != 'undefined'  ) {
						 transactionHash1 = contract.transactionHash;
					}
				} );
			 setTimeout(trySetContract1, 2000);	
			//ethContract = my.at("0x60292327fdaad719e3a61c6262296c0d8288db00");
		}
		alert("Deploy submitted!");
	}

	// cph.getTransactionReceipt("0x7b06c9137d3528129d85e9911cb0cc206c9aa0e79188eec4c4a0c83aecdbd316")

	function getContractInfo(stype){
		if( stype=="java" ) {
			alert("contract.address=" + javaContract.address + "\n name=" + javaContract.name() 
			+ "\n symbol=" + javaContract.symbol() 
			+ "\n totalSupply=" + javaContract.totalSupply() );
		}else{
			alert("contract.address=" + ethContract.address
			+ "\n name=" + ethContract.name() 
			+ "\n symbol=" + ethContract.symbol() 
			+ "\n totalSupply=" + ethContract.totalSupply() );
		}
	}
		
	function create_account(n){
		sAddr =  web3.personal.newAccount(document.getElementById('Password').value);
		if( n==1 )
			sFrom = sAddr;
		else
			sTo = sAddr;

		document.getElementById('Acc'+ n).value = sAddr;
	}
</script>
</head>
<body>
<H3 align=center>Contract Demo </H3>
Rpc node:<input id=rpcnode value="http://localhost:8000"><hr>

From Account<button onClick="create_account(1)">Create</button> : <input id="Acc1" style='width:300px' value="0x228555de367154a128348950d3dee915bc79c423">
&nbsp;&nbsp;Password:<input id="Password" style='width:60px' value="1">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
To Account<button onClick="create_account(2)">Create</button> : <input id="Acc2" style='width:300px' value="0x004049d5769fba80e40dfe6e98d2165fcebe943b">
<hr><br>
    Java contract bytecode: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<button onClick="deployContract('java');">Deploy</button>&nbsp;&nbsp;&nbsp;&nbsp;
	<button id="getContractInfo0"  onClick="getContractInfo('java');">Get contract info</button>&nbsp;&nbsp;<span id=ContractAddress1></span><br>
	<textarea id="javabytes" cols=185 rows=10>0xcafebabe0000003400a70a0032005405000000000000271009005500560800390a0057005808005908005a08005b0a005c005d0a005e005f0a005e00600700610a000d00540800620a000d00630a000d006408006508006608006708006808006908006a0a0031006b0a006c006d0a003200640a005c006e08006f0800700800710800720a005c00730a005c007408007508007608007708007808007908007a08007b0a005e007c0a006c007d0a006c007e07007f09003100800a003200810a006c00820a006c00830700840700850100046465666a01000c4c6d6a736f6e2f4a736f6e3b0100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100046d61696e010016285b4c6a6176612f6c616e672f537472696e673b29560100087365744163746f7201004a284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000d537461636b4d61705461626c65070086010008726567697374657201006e284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b010009656475636174696f6e01005c284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b0100057072697a65010005656e7472790100056c656176650100097265636f6d6d656e64010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b010006726573756d6501000c67657453746174654a736f6e010020284c6a6176612f6c616e672f537472696e673b294c6d6a736f6e2f4a736f6e3b07008707007f01000d6765744a736f6e56616c756553010032284c6d6a736f6e2f4a736f6e3b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000867657456616c7565010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b0100083c636c696e69743e01000a536f7572636546696c650100155f6379706865725f636f6e74726163742e6a6176610c003500360700880c0089008a07008b0c008c008d0100024852010007485220436f696e01000007008e0c008f00900700860c009100920c009300940100176a6176612f6c616e672f537472696e674275696c646572010005616464723a0c009500960c00970094010007636f6d70616e7901000b4048525f636f6d70616e790100077465616368657201000b4048525f746561636865720100067072697a657201000a4048525f7072697a65720c0049004a0700870c009800990c009a009b0100026f6b0100064062617369630100014001000840636f6e746163740c009c00500c009d005001001a6e6f7420666f756e64207468652073747564656e74277320696401000a40656475636174696f6e0100106e6f7420666f756e6420746865206964010006407072697a6501000640656e747279010006406c6561766501000a407265636f6d6d656e640c009e009f0c00a000a10c00a2004a0100136a6176612f6c616e672f457863657074696f6e0c003300340c00a300a40c00a5004a0c00a600940100105f6379706865725f636f6e74726163740100106a6176612f6c616e672f4f626a6563740100106a6176612f6c616e672f537472696e6701000a6d6a736f6e2f4a736f6e0100106a6176612f6c616e672f53797374656d0100036f75740100154c6a6176612f696f2f5072696e7453747265616d3b0100136a6176612f696f2f5072696e7453747265616d0100077072696e746c6e010015284c6a6176612f6c616e672f537472696e673b29560100136a617661782f6379706865722f4379706e657401000c736574546f6b656e496e666f01003a284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a4c6a6176612f6c616e672f537472696e673b295a010009737562737472696e670100152849294c6a6176612f6c616e672f537472696e673b01000b746f55707065724361736501001428294c6a6176612f6c616e672f537472696e673b010006617070656e6401002d284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e674275696c6465723b010008746f537472696e67010003736574010032284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f4f626a6563743b294c6d6a736f6e2f4a736f6e3b0100087365745374617465010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b295a01000a676574416464726573730100086765745374617465010007696e6465784f66010015284c6a6176612f6c616e672f537472696e673b29490100066f626a65637401000e28294c6d6a736f6e2f4a736f6e3b01000472656164010006657175616c73010015284c6a6176612f6c616e672f4f626a6563743b295a01000261740100086173537472696e67002100310032000000010008003300340000000e000100350036000100370000001d00010001000000052ab70001b10000000100380000000600010000000400090039003a000100370000003c000500030000001814000240b200041205b60006120712081f1209b8000a57b1000000010038000000120004000000090004000a000c000c0017000f0009003b003c00010037000000c500030005000000682a1024b6000bb6000c4bb20004bb000d59b7000e120fb600102ab60010b60011b6000612094e2b1212a6000912134ea7001e2b1214a6000912154ea700122b1216a6000912174ea700061209b02db800183a0419042a2cb60019572d1904b6001ab8001b57121cb00000000200380000003a000e00000015000a00160023001800260019002c001a0032001b0038001c003e001d0044001e004a0020004d002200530023005b002400650025003d0000000b0004fc003207003e0b0b020009003f0040000100370000009100030006000000652a1024b6000bb6000c4bbb000d59b7000e2ab60010121db60010b600113a051905bb000d59b7000e2bb60010121eb600102cb60010121eb600102db60010b60011b8001b57bb000d59b7000e2ab60010121fb60010b600113a0519051904b8001b57121cb00000000100380000001a00060000002a000a002b001f002c0045002d005a002e0062002f00090041004200010037000000ed00040008000000951209b800203a0419041024b6000bb6000c3a042a1024b6000bb6000c4bbb000d59b7000e2ab60010121db60010b600113a051905b800213a0619061209a600061222b0bb000d59b7000e2ab600101223b60010b600113a051905b800183a0719071904bb000d59b7000e2bb60010121eb600102cb60010121eb600102db60010b60011b600195719051907b6001ab8001b57121cb000000002003800000032000c000000330007003800130039001d003a0032003b0039003c0040003d0043003f00580040005f00410087004200920044003d0000000e0001fe004307003e07003e07003e00090043003c00010037000000e000040007000000881209b800204e2d1024b6000bb6000c4e2a1024b6000bb6000c4bbb000d59b7000e2ab60010121db60010b600113a041904b800213a0519051209a600061224b0bb000d59b7000e2ab600101225b60010b600113a041904b800183a0619062dbb000d59b7000e2bb60010121eb600102cb60010b60011b600195719041906b6001ab8001b57121cb000000002003800000032000c000000480006004d0010004e001a004f002f005000360051003d00520040005400550055005c0056007a005700850059003d0000000e0001fe004007003e07003e07003e00090044003c00010037000000e000040007000000881209b800204e2d1024b6000bb6000c4e2a1024b6000bb6000c4bbb000d59b7000e2ab60010121db60010b600113a041904b800213a0519051209a600061224b0bb000d59b7000e2ab600101226b60010b600113a041904b800183a0619062dbb000d59b7000e2bb60010121eb600102cb60010b60011b600195719041906b6001ab8001b57121cb000000002003800000032000c0000005d0006006200100063001a0064002f006500360066003d0067004000690055006a005c006b007a006c0085006e003d0000000e0001fe004007003e07003e07003e00090045003c000100370000009600040006000000621209b800204e2d1024b6000bb6000c4e2a1024b6000bb6000c4bbb000d59b7000e2ab600101227b60010b600113a041904b800183a0519052dbb000d59b7000e2bb60010121eb600102cb60010b60011b600195719041905b6001ab8001b57121cb0000000010038000000220008000000720006007700100078001a0079002f007a0036007b0054007c005f007d00090046004700010037000000ea000200050000008c1209b800204d2c1024b6000bb6000c4d2a1024b6000bb6000c4bbb000d59b7000e2ab60010121db60010b600114e2db800213a0419041209a600061224b0bb000d59b7000e2ab600101228b60010b600114e2db800213a0419041209a5000c19042bb600299c0024bb000d59b7000e1904b60010121eb600102bb60010b600113a042d1904b8001b57121cb000000002003800000036000d000000810006008200100083001a0084002e008500340086003b0087003e00890052008a0058008b0068008c0082008d0089008f003d000000100003fe003e07003e07003e07003e2920000900480047000100370000004100020002000000252a1024b6000bb6000c4bbb000d59b7000e2ab60010121eb600102bb60010b60011b80021b00000000100380000000a000200000093000a009400080049004a0001003700000072000200040000001e2ab800214cb8002a4d2bc600122b1209a5000c2bb8002b4da700044e2cb0000100130018001b002c000200380000001e000700000098000500990009009a0013009d0018009f001b009e001c00a1003d000000160002ff001b000307003e07003e07004b000107004c000008004d004e000100370000005a000200030000001f2ab2002db6002e9900061209b02a2bb6002f4d2cc700061209b02cb60030b00000000200380000001a0006000000a5000a00a6000d00a7001300a8001700a9001a00aa003d0000000900020dfc000c07004b0009004f0050000100370000002300010002000000072ab800214c2bb00000000100380000000a0002000000ad000500ae000800510036000100370000001f0001000000000007b8002ab3002db10000000100380000000600010000000600010052000000020053</textarea>
    <br>Solidity contract bytecode:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<button onClick="deployContract('');">Deploy</button>&nbsp;&nbsp;&nbsp;&nbsp;
	<button id="getContractInfo1"  onClick="getContractInfo('');">Get contract info</button>&nbsp;&nbsp;<span id=ContractAddress2></span><br>
	<textarea id="ethbytes" cols=185 rows=10>0x60606040526003805460ff19166012179055341561001c57600080fd5b6040516106bf3803806106bf833981016040528080519190602001805182019190602001805160008054600160a060020a033316600160a060020a03199091168117825560035460ff16600a0a870260048190559082526005602052604090912055909101905060018280516100969291602001906100b3565b5060028180516100aa9291602001906100b3565b5050505061014e565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100f457805160ff1916838001178555610121565b82800160010185558215610121579182015b82811115610121578251825591602001919060010190610106565b5061012d929150610131565b5090565b61014b91905b8082111561012d5760008155600101610137565b90565b6105628061015d6000396000f30060606040526004361061008d5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166306fdde03811461009257806318160ddd1461011c578063313ce5671461014157806370a082311461016a5780638da5cb5b1461018957806395d89b41146101b8578063a9059cbb146101cb578063f2fde38b146101ef575b600080fd5b341561009d57600080fd5b6100a561020e565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100e15780820151838201526020016100c9565b50505050905090810190601f16801561010e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012757600080fd5b61012f6102ac565b60405190815260200160405180910390f35b341561014c57600080fd5b6101546102b2565b60405160ff909116815260200160405180910390f35b341561017557600080fd5b61012f600160a060020a03600435166102bb565b341561019457600080fd5b61019c6102cd565b604051600160a060020a03909116815260200160405180910390f35b34156101c357600080fd5b6100a56102dc565b34156101d657600080fd5b6101ed600160a060020a0360043516602435610347565b005b34156101fa57600080fd5b6101ed600160a060020a0360043516610356565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102a45780601f10610279576101008083540402835291602001916102a4565b820191906000526020600020905b81548152906001019060200180831161028757829003601f168201915b505050505081565b60045481565b60035460ff1681565b60056020526000908152604090205481565b600054600160a060020a031681565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102a45780601f10610279576101008083540402835291602001916102a4565b6103523383836103a0565b5050565b60005433600160a060020a0390811691161461037157600080fd5b6000805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055565b6000600160a060020a03831615156103b757600080fd5b600160a060020a038416600090815260056020526040902054829010156103dd57600080fd5b600160a060020a0383166000908152600560205260409020548281011161040357600080fd5b600160a060020a03808516600090815260056020526040808220549286168252902054610430919061050e565b600160a060020a0385166000908152600560205260409020549091506104569083610524565b600160a060020a038086166000908152600560205260408082209390935590851681522054610485908361050e565b600160a060020a03808516600081815260056020526040908190209390935591908616907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9085905190815260200160405180910390a3600160a060020a0380841660009081526005602052604080822054928716825290205401811461050857fe5b50505050565b60008282018381101561051d57fe5b9392505050565b60008183101561053057fe5b509003905600a165627a7a72305820ef52f1fb842a19c293e472e64fafa97cac12ee6b2df258fbd24c7ac03a54fab5002900000000000000000000000000000000000000000000000000000001a13b8600000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000015636f6d6d6f6e7765616c20636861696e206c6f76650000000000000000000000000000000000000000000000000000000000000000000000000000000000000a434d434c2d746f6b656e00000000000000000000000000000000000000000000</textarea>
    <div id="code"></div> 
    <div id="status"></div>
    <div id="result"></div>
</body>
</html>
